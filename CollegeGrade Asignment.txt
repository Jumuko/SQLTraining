/**********************************************************************************************************************
DEVELOPER: JOHN O. UMUKORO
DATE CREATED: 2024-10-3
CODE VERSION: 1.0
DESCRIPTION: THIS CODE PROVIDES INFORMATION ABOUT COLLEGE GRADES: STUDENTNAME,SUBJECT,MARKS

**********************************************************************************************************************/

CREATE TABLE COLLEGEGRADE 
(STUDENTNAME VARCHAR(70), 
 SUBJECT     VARCHAR(20), 
 MARKS       INT
);
INSERT INTO COLLEGEGRADE 
VALUES
('LILY', 
 'MATHS', 
 65
);
INSERT INTO COLLEGEGRADE 
VALUES
('LILY', 
 'SCIENCE', 
 80
);
INSERT INTO COLLEGEGRADE 
VALUES
('LILY', 
 'ENGLISH', 
 70
);
INSERT INTO COLLEGEGRADE 
VALUES
('ISABELLA', 
 'MATHS', 
 50
);
INSERT INTO COLLEGEGRADE 
VALUES
('ISABELLA', 
 'SCIENCE', 
 70
);
INSERT INTO COLLEGEGRADE 
VALUES
('ISABELLA', 
 'ENGLISH', 
 90
);
INSERT INTO COLLEGEGRADE 
VALUES
('OLIVIA', 
 'MATHS', 
 55
);
INSERT INTO COLLEGEGRADE
VALUES
('OLIVIA', 
 'SCIENCE', 
 60
);
INSERT INTO COLLEGEGRADE
VALUES
('OLIVIA', 
 'ENGLISH', 
 89
);


--CHECK NEWLY CREATED TABLE
SELECT *
FROM COLLEGEGRADE

--QUESTION 1: GENERATE A REPORT THAT SHOWS WHO CAME 1ST PLACE IN MATHS, SCIENCE, AND ENGLISH.
SELECT *
FROM
	(
	SELECT *,
		DENSE_RANK() OVER (PARTITION BY SUBJECT ORDER BY MARKS DESC) AS DRNK
	FROM COLLEGEGRADE
	) X
WHERE DRNK = 1;

--2ND APPROACH
WITH GRADE AS
	(
	SELECT SUBJECT,
		DENSE_RANK() OVER (PARTITION BY SUBJECT ORDER BY MARKS DESC) AS DRNK
	FROM COLLEGEGRADE
	) 
SELECT *
FROM GRADE
WHERE DRNK = 1

--QUESTION 2: WHAT IS THE AVERAGE MARK FOR MATHS,SCIENCE,AND ENGLISH

SELECT 
	AVG(MARKS) AS MATHS_AVG
FROM COLLEGEGRADE
WHERE SUBJECT = 'MATHS'

SELECT 
	AVG(MARKS) AS ENGLISH_AVG
FROM COLLEGEGRADE
WHERE SUBJECT = 'ENGLISH'

SELECT 
	AVG(MARKS) AS SCIENCE_AVG
FROM COLLEGEGRADE
WHERE SUBJECT = 'SCIENCE';

--QUESTION 3: CONDUCT GAP ANALYSIS USING METRICS:SUM, USING EXISTS, AND UNION
--USING SUM METRICS
SELECT 'DEV' AS SOURCE, 
SUM(MARKS) AS TOTAL_SCORE
FROM COLLEGEGRADE;

SELECT 'TEST' AS SOURCE, 
SUM(MARKS) AS TOTAL_SCORE
FROM COLLEGEGRADE;

--USING EXISTS
SELECT 'DEV' AS SOURCE, 
SUM(MARKS) AS TOTAL_SCORE
FROM COLLEGEGRADE
WHERE EXISTS 
(SELECT 'TEST' AS SOURCE, 
SUM(MARKS) AS TOTAL_SCORE
FROM DEV.DBO.COLLEGEGRADE);

SELECT 'DEV' AS SOURCE, 
SUM(MARKS) AS TOTAL_SCORE
FROM DEV.DBO.COLLEGEGRADE
UNION
(SELECT 'TEST' AS SOURCE, 
SUM(MARKS) AS TOTAL_SCORE
FROM TEST.DBO.COLLEGEGRADE);

SELECT *
FROM
	(
	SELECT 
	--StudentName,
	SUBJECT,
	--MARKS,
	SUM(MARKS) AVG_MARKS
	FROM COLLEGEGRADE
	GROUP BY 
	--StudentName,
	SUBJECT
	--MARKS
	) SOURCETABLE

PIVOT(AVG([AVG_MARKS])
FOR SUBJECT IN ([MATHS],[ENGLISH],[SCIENCE])
	) SUBJECTPIVOT;

	SELECT *
FROM COLLEGEGRADE
