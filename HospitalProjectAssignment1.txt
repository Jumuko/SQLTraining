
/**********************************************************************************************************************
DEVELOPER: JOHN O. UMUKORO
DATE CREATED: 2024-10-3
CODE VERSION: 1.0
DESCRIPTION: THIS CODE PROVIDES INFORMATION ABOUT PATIENT ENCOUNTERS IN THE HOSPITAL

**********************************************************************************************************************/


--QUESTION 1: WRITE A QUERY THAT DOES THE FOLLOWING: LISTS OUT NUMBER OF PATIENTS IN DESCENDING ORDER,DOES NOT INCLUDE CITY QUINCY,
--			  MUST HAVE AT LEAST 2 PATIENTS FROM THAT CITY
SELECT DISTINCT 
	CITY, 
	COUNT(ID) AS P
FROM PATIENTSDATA
WHERE CITY <> 'QUINCY'
GROUP BY CITY
HAVING COUNT(ID) > 1
ORDER BY CITY DESC;


--QUESTION 2: FIND OUT THE PATIENTS WITH THE HIGHEST NUMBER OF VISITS
WITH VISITS AS
		(
	SELECT DISTINCT 
		B.CITY,
		A.PATIENT,
		B.ID,
		SUM(COUNT(B.ID)) AS NUMBEROFVISITS
	FROM ENCOUNTERSDATA A
		JOIN PATIENTSDATA B 
		ON A.PATIENT=B.ID
	GROUP BY B.CITY,A.PATIENT,B.ID
	--ORDER BY 4 DESC,1
		)

SELECT *
FROM VISITS
WHERE NUMBEROFVISITS =
	(
	SELECT 
	MAX(NUMBEROFVISITS) AS MAXVISITS
	FROM VISITS
	);

--QUESTION 3: TO FIND OUT THE TOP 10 PATIENTS WITH THE MOST VISITS TO THE HOSPITAL
WITH VISITS AS
		(
	SELECT  
		B.CITY,
		A.PATIENT,
		B.ID,
		COUNT(B.ID) AS NUMBEROFVISITS
	FROM ENCOUNTERSDATA A
		JOIN PATIENTSDATA B 
		ON A.PATIENT=B.ID
	GROUP BY 
		B.CITY,
		A.PATIENT,
		B.ID
		)

SELECT 
	TOP 10 *
FROM VISITS
ORDER BY NUMBEROFVISITS DESC;

⁠-- QUESTION 4: TO FIND OUT THE NUMBER OF TIMES PATIENTS FROM EACH CITY VISITED THE HOSPITAL
SELECT DISTINCT
	B.CITY,
	A.PATIENT,
	B.ID,
	COUNT(B.ID) AS NUMBEROFVISITS
FROM ENCOUNTERSDATA A
	JOIN PATIENTSDATA B 
	ON A.PATIENT=B.ID
GROUP BY 
	B.CITY,
	A.PATIENT,
	B.ID
ORDER BY NUMBEROFVISITS DESC;

--QUESTION 5: ⁠TO FIND OUT THE CITIES WITH UP TO 50 COUNTS OF EMERGENCY CASES.
SELECT 
	B.CITY,
	A.ENCOUNTERCLASS,
	COUNT(ENCOUNTERCLASS) AS COUNTSOFEMERGENCYCASES
FROM ENCOUNTERSDATA A
	JOIN PATIENTSDATA B 
	ON A.PATIENT=B.ID
WHERE ENCOUNTERCLASS = 'EMERGENCY'
GROUP BY 
B.CITY,
A.ENCOUNTERCLASS
--HAVING COUNT(ENCOUNTERCLASS) >= 50
ORDER BY COUNTSOFEMERGENCYCASES DESC;⁠

SELECT DISTINCT
	B.*,
	A.PATIENT
	--COUNT(ENCOUNTERCLASS) AS COUNTSOFEMERGENCYCASES
FROM ENCOUNTERSDATA A
	JOIN PATIENTSDATA B 
	ON A.PATIENT=B.ID
WHERE ENCOUNTERCLASS = 'EMERGENCY'
GROUP BY 
B.CITY,
A.ENCOUNTERCLASS
--HAVING COUNT(ENCOUNTERCLASS) >= 50
--ORDER BY COUNTSOFEMERGENCYCASES DESC

SELECT 
	COUNT (DISTINCT ENCOUNTERCLASS) AS COUNTSOFEMERGENCYCASES
FROM ENCOUNTERSDATA A
	JOIN PATIENTSDATA B 
	ON A.PATIENT=B.ID
WHERE ENCOUNTERCLASS = 'EMERGENCY'

SELECT 
	COUNT (ALL ENCOUNTERCLASS) AS COUNTSOFEMERGENCYCASES
FROM ENCOUNTERSDATA A
	JOIN PATIENTSDATA B 
	ON A.PATIENT=B.ID
WHERE ENCOUNTERCLASS = 'EMERGENCY'

--QUESTION 6: ⁠NOW TO FIND OUT THE NUMBER OF PATIENTS FROM BOSTON WHO CAME IN 2020
SELECT 
	B.CITY,
	COUNT(A.PATIENT) AS NUMBEROFPATIENTS
FROM ENCOUNTERSDATA A
	JOIN PATIENTSDATA B 
	ON A.PATIENT=B.ID
WHERE B.CITY = 'BOSTON' 
	AND START LIKE '2020%'
GROUP BY 
B.CITY;

-- QUESTION 7: TO FIND OUT THE TOP RECURRING CONDITIONS.
WITH RECCURRINGCONDITIONS AS
	(
	SELECT DISTINCT 
		A.DESCRIPTION,
		COUNT(*) AS NUMBEROFRECURRENCE
	FROM CONDITIONSDATA A
		JOIN PATIENTSDATA B 
		ON A.PATIENT=B.ID
	GROUP BY A.DESCRIPTION
	)
SELECT 
	TOP 5 DESCRIPTION,
	NUMBEROFRECURRENCE
FROM RECCURRINGCONDITIONS
ORDER BY NUMBEROFRECURRENCE DESC;


--QUESTION 8: TO FIND OUT THE MONTH WITH THE HIGHEST NUMBER OF AMBULATORY CASES SINCE 2010
SELECT 
	TOP 1 NUMBEROFAMBULATORYCASES,
	YEAR,
	MONTH
FROM
	(
	SELECT DISTINCT
		DATEPART(YEAR, A.START) AS YEAR,
		DATEPART(MONTH, A.START) AS MONTH,
		COUNT(A.ENCOUNTERCLASS) AS NUMBEROFAMBULATORYCASES
	FROM ENCOUNTERSDATA A
		JOIN PATIENTSDATA B 
		ON A.PATIENT=B.ID
	WHERE ENCOUNTERCLASS = 'AMBULATORY'
	GROUP BY 
		DATEPART(YEAR, A.START), 
		DATEPART(MONTH, A.START)
	HAVING DATEPART(YEAR, A.START) >= 2010
	) X
 ORDER BY NUMBEROFAMBULATORYCASES DESC;

--QUESTION 9: ⁠TO FIND OUT THE MONTH WITH THE HIGHEST NUMBER OF EMERGENCY CASES SINCE 2010.

SELECT 
	TOP 1 NUMBEROFEMERGENCYCASES,
	YEAR,
	MONTH
FROM
	(
	SELECT DISTINCT
		DATEPART(YEAR, A.START) AS YEAR,
		DATEPART(MONTH, A.START) AS MONTH,
		COUNT(A.ENCOUNTERCLASS) AS NUMBEROFEMERGENCYCASES
	FROM ENCOUNTERSDATA A
		JOIN PATIENTSDATA B 
		ON A.PATIENT=B.ID
	WHERE ENCOUNTERCLASS = 'EMERGENCY'
	GROUP BY 
		DATEPART(YEAR, A.START), 
		DATEPART(MONTH, A.START)
	HAVING DATEPART(YEAR, A.START) >= 2010
	) X
ORDER BY NUMBEROFEMERGENCYCASES DESC

 --QUESTION 10: ⁠NOW TO FIND OUT THE TOP 15 YEARS WITH THE MOST IMMUNIZATIONS.
SELECT 
	TOP 15 NUMBEROFIMMUNIZATIONS,
	YEAR
FROM
	(
	SELECT DISTINCT
		DATEPART(YEAR, A.DATE) AS YEAR,
		COUNT(A.ENCOUNTER) AS NUMBEROFIMMUNIZATIONS
	FROM IMMUNIZATIONSDATA A
		JOIN PATIENTSDATA B 
		ON A.PATIENT=B.ID
	GROUP BY 
		DATEPART(YEAR, A.DATE) )X
ORDER BY NUMBEROFIMMUNIZATIONS DESC;

