/**********************************************************************************************************************
DEVELOPER: JOHN O. UMUKORO
DATE CREATED: 2025-03-25
CODE VERSION: 1.0
DESCRIPTION: THIS CODE PROVIDES INFORMATION ABOUT COVID DEATH AND COVID VACCINATION
PROJECT SCOPE:  A: LOAD EMADECOVIDDEATH.CSV AND EMADECOVIDVACCINATION.CSV TO DATABASE 
				B: CREATE SQL QUERIES TO GENERATE METRICS: 
					1. SHOW TOTAL CASES VS TOTAL DEATHS, 
					2. WHAT PERCENTAGE OF THE POPULATION IS AFFECTED BY COVID?
					3. SHOW COUNTRIES WITH HIGHEST INFECTION RATE COMPARED TO POPULATION
					4. SHOW COUNTRIES WITH THE HIGHEST DEATH COUNT PER POPULATION
					5. DISPLAYS THE CONTINENT WITH THE HIGHEST DEATH COUNT PER POPULATION.
					6. SHOW THE TOTAL POPULATION OF A LOCATION WITH THE NUMBER OF PEOPLE WHO HAVE BEEN VACCINATED
					7. SHOW THE PERCENTAGE OF THE POPULATION VACCINATED IN DIFFERENT COUNTRIES AND CONTINENTS.
					8. WHAT IS THE MORTALITY RATE - TOTAL DEATHS DIVIDED BY TOTAL CASES? (NOTE MORTALITY RATE IS THE DEATH RATE DIVIDED BY TOTAL CASES
					9. WHAT ARE THE GLOBAL CASES FOR EACH DAY? 
				C: PRODUCE A BUSINESS INTELLIGENCE REPORT FOR EACH DATASET SHOWING THESE KPIS
**********************************************************************************************************************/

SELECT * FROM EMADECOVIDDEATH
SELECT* FROM EMADECOVIDVACCINATION



--1. SHOW TOTAL CASES VS TOTAL DEATHS
SELECT TOTAL_CASES,TOTAL_DEATHS 
FROM EMADECOVIDDEATH

--2. WHAT PERCENTAGE OF THE POPULATION IS AFFECTED BY COVID?
--	CALCULATE THE PERCENTAGE OF POPULATION AFFECTED BY COVID-19 WHILE AVOIDING DIVISION BY ZERO
WITH LATESTDATA AS (
    SELECT
        LOCATION,
        POPULATION,
        TOTAL_CASES,
        ROW_NUMBER() OVER (PARTITION BY LOCATION ORDER BY DATE DESC) AS RN
    FROM EMADECOVIDDEATH
    WHERE POPULATION IS NOT NULL 
      AND TOTAL_CASES IS NOT NULL
)
SELECT
    LOCATION,
    POPULATION,
    TOTAL_CASES,
    CASE 
        WHEN POPULATION = 0 THEN 0
        ELSE CAST(TOTAL_CASES AS FLOAT) / POPULATION * 100 
    END AS PERCENTAGE_AFFECTED
FROM LATESTDATA
WHERE RN = 1;

-- 3. SHOW COUNTRIES WITH THE HIGHEST COVID-19 INFECTION RATE RELATIVE TO THEIR POPULATION
WITH LATESTDATA AS (
    SELECT
        LOCATION,
        POPULATION,
        TOTAL_CASES,
        ROW_NUMBER() OVER (PARTITION BY LOCATION ORDER BY DATE DESC) AS RN
    FROM EMADECOVIDDEATH
    WHERE POPULATION IS NOT NULL 
      AND TOTAL_CASES IS NOT NULL
)
SELECT
    LOCATION,
    POPULATION,
    TOTAL_CASES,
    CASE 
        WHEN POPULATION = 0 THEN 0
        ELSE CAST(TOTAL_CASES AS FLOAT) / POPULATION * 100 
    END AS PERCENTAGE_AFFECTED
FROM LATESTDATA
WHERE RN = 1
ORDER BY PERCENTAGE_AFFECTED DESC;

-- 4. SHOW COUNTRIES WITH THE HIGHEST COVID-19 DEATH RATE RELATIVE TO THEIR POPULATION
WITH LATESTDATA AS (
    SELECT
        LOCATION,
        POPULATION,
        TOTAL_DEATHS,
        ROW_NUMBER() OVER (PARTITION BY LOCATION ORDER BY DATE DESC) AS RN
    FROM EMADECOVIDDEATH
    WHERE POPULATION IS NOT NULL 
      AND TOTAL_DEATHS IS NOT NULL
)
SELECT
    LOCATION,
    POPULATION,
    TOTAL_DEATHS,
    CASE 
        WHEN POPULATION = 0 THEN 0
        ELSE CAST(TOTAL_DEATHS AS FLOAT) / POPULATION * 100 
    END AS DEATH_RATE_PERCENTAGE
FROM LATESTDATA
WHERE RN = 1
ORDER BY DEATH_RATE_PERCENTAGE DESC;

-- 5. SHOW CONTINENT WITH THE HIGHEST COVID-19 DEATH RATE RELATIVE TO ITS POPULATION
WITH LATESTDATA AS (
    SELECT
        CONTINENT,
        LOCATION,
        POPULATION,
        TOTAL_DEATHS,
        ROW_NUMBER() OVER (PARTITION BY LOCATION ORDER BY DATE DESC) AS RN
    FROM EMADECOVIDDEATH
    WHERE CONTINENT IS NOT NULL
      AND POPULATION IS NOT NULL 
      AND TOTAL_DEATHS IS NOT NULL
)
, LATESTPERCOUNTRY AS (
    SELECT CONTINENT, POPULATION, TOTAL_DEATHS
    FROM LATESTDATA
    WHERE RN = 1 AND POPULATION > 0
)
SELECT
    CONTINENT,
    SUM(TOTAL_DEATHS) AS TOTAL_DEATHS,
    SUM(POPULATION) AS TOTAL_POPULATION,
    SUM(CAST(TOTAL_DEATHS AS FLOAT)) / SUM(POPULATION) * 100 AS DEATH_RATE_PERCENTAGE
FROM LATESTPERCOUNTRY
GROUP BY CONTINENT
ORDER BY DEATH_RATE_PERCENTAGE DESC;


-- 6. SHOW THE TOTAL POPULATION AND NUMBER OF PEOPLE VACCINATED PER LOCATION
SELECT
    DISTINCT LOCATION,
    POPULATION,
    PEOPLE_VACCINATED
FROM EMADECOVIDDEATH


-- 7. SHOW PERCENTAGE OF POPULATION VACCINATED PER COUNTRY AND CONTINENT
WITH LATESTDATA AS (
    SELECT
        CONTINENT,
        LOCATION,
        POPULATION,
        PEOPLE_VACCINATED,
        ROW_NUMBER() OVER (PARTITION BY LOCATION ORDER BY DATE DESC) AS RN
    FROM EMADECOVIDDEATH
    WHERE CONTINENT IS NOT NULL
      AND POPULATION IS NOT NULL
      AND POPULATION > 0
      AND PEOPLE_VACCINATED IS NOT NULL
)
SELECT
    CONTINENT,
    LOCATION AS COUNTRY,
    POPULATION,
    PEOPLE_VACCINATED,
    CAST(PEOPLE_VACCINATED AS FLOAT) / POPULATION * 100 AS VACCINATION_PERCENTAGE
FROM LATESTDATA
WHERE RN = 1
ORDER BY VACCINATION_PERCENTAGE DESC;

-- 8. CALCULATE COVID-19 MORTALITY RATE (TOTAL DEATHS DIVIDED BY TOTAL CASES) PER COUNTRY
WITH LATESTDATA AS (
    SELECT
        LOCATION,
        TOTAL_DEATHS,
        TOTAL_CASES,
        ROW_NUMBER() OVER (PARTITION BY LOCATION ORDER BY DATE DESC) AS RN
    FROM EMADECOVIDDEATH
    WHERE TOTAL_DEATHS IS NOT NULL
      AND TOTAL_CASES IS NOT NULL
)
SELECT
    LOCATION,
    TOTAL_CASES,
    TOTAL_DEATHS,
    CAST(TOTAL_DEATHS AS FLOAT) / TOTAL_CASES * 100 AS MORTALITY_RATE
FROM LATESTDATA
WHERE RN = 1 AND TOTAL_CASES > 0
ORDER BY MORTALITY_RATE DESC;

-- 19. SHOW GLOBAL DAILY COVID-19 CASE TOTALS
SELECT
    DATE,
    SUM(NEW_CASES) AS GLOBAL_NEW_CASES
FROM EMADECOVIDDEATH
GROUP BY DATE
ORDER BY DATE;
